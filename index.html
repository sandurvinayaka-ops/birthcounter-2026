<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Live Birth Tracker | Global Pulse</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://d3js.org/d3.v7.min.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&family=JetBrains+Mono:wght@500&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Inter', sans-serif;
      background-color: #010105; 
      color: #f1f5f9;
      margin: 0;
      padding: 0;
      overflow: hidden;
    }
    .mono { font-family: 'JetBrains+Mono', monospace; }
    
    .space-background {
      position: fixed;
      top: 0; left: 0; width: 100%; height: 100%;
      z-index: -1;
      background: radial-gradient(circle at 70% 30%, #030712 0%, #000000 100%);
    }

    .nebula {
      position: absolute;
      width: 150%; height: 150%;
      top: -25%; left: -25%;
      background: radial-gradient(circle at 50% 50%, rgba(30, 58, 138, 0.08) 0%, transparent 60%);
      filter: blur(80px);
      pointer-events: none;
      animation: drift 120s linear infinite alternate;
    }

    @keyframes drift {
      from { transform: translate(-1%, -1%) rotate(0deg); }
      to { transform: translate(1%, 1%) rotate(2deg); }
    }

    .star {
      position: absolute;
      border-radius: 50%;
      pointer-events: none;
    }

    @keyframes shimmer {
      0% { opacity: 0.1; transform: scale(0.8); }
      50% { opacity: 0.9; transform: scale(1.2); }
      100% { opacity: 0.2; transform: scale(1); }
    }

    .star-shine {
      animation: shimmer var(--duration) ease-in-out infinite alternate;
    }

    .glass-sidebar {
      background: linear-gradient(90deg, #000 0%, rgba(0,0,0,0.8) 70%, transparent 100%);
    }

    .counter-glow {
      color: #fbbf24;
      font-weight: 900;
      text-shadow: 0 0 40px rgba(251, 191, 36, 0.4), 0 0 100px rgba(251, 191, 36, 0.1);
      letter-spacing: -0.05em;
      line-height: 0.85;
    }

    .progress-track {
      height: 4px;
      background: rgba(251, 191, 36, 0.08);
      border-radius: 2px;
    }

    .progress-fill {
      height: 100%;
      background: #fbbf24;
      box-shadow: 0 0 15px #fbbf24;
      transition: width 1s linear;
      position: relative;
    }

    .time-pin {
      position: absolute;
      top: 100%;
      padding-top: 20px;
      transform: translateX(-50%);
      transition: left 1s linear;
    }

    .time-label {
      font-size: 0.85rem;
      color: #fbbf24;
      font-weight: 700;
      text-shadow: 0 0 8px rgba(251, 191, 36, 0.6);
      white-space: nowrap;
    }

    .pulse-dot {
      width: 8px;
      height: 8px;
      background: #ef4444;
      border-radius: 50%;
      display: inline-block;
      margin-right: 8px;
      box-shadow: 0 0 10px #ef4444;
      animation: pulse 1.5s infinite;
    }

    @keyframes pulse {
      0% { transform: scale(0.95); opacity: 0.7; }
      50% { transform: scale(1.1); opacity: 1; box-shadow: 0 0 20px #ef4444; }
      100% { transform: scale(0.95); opacity: 0.7; }
    }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect, useRef, useMemo } = React;

    const BIRTHS_PER_SECOND = 4.35;
    const FLASH_BURST_COLOR = "#FFFFFF"; 
    const FLASH_BLOOM_COLOR = "#fbbf24"; 
    const LAND_COLOR = "#1a1a20"; 
    const ROTATION_SPEED = 0.3; 

    const generateStars = (count) => {
      const colors = ['#ffffff', '#fffaf0', '#ffd700', '#f1f5f9'];
      return Array.from({ length: count }).map((_, i) => ({
        id: i,
        top: `${Math.random() * 100}%`,
        left: `${Math.random() * 100}%`,
        size: Math.random() * 2 + 0.5,
        color: colors[Math.floor(Math.random() * colors.length)],
        duration: `${Math.random() * 3 + 2}s`,
        delay: `${Math.random() * -10}s`
      }));
    };

    const StarField = () => {
      const stars = useMemo(() => generateStars(300), []);
      return (
        <div className="space-background">
          <div className="nebula"></div>
          {stars.map(s => (
            <div 
              key={s.id} 
              className="star star-shine" 
              style={{
                top: s.top, 
                left: s.left, 
                width: `${s.size}px`, 
                height: `${s.size}px`,
                backgroundColor: s.color,
                '--duration': s.duration,
                animationDelay: s.delay
              }}
            />
          ))}
        </div>
      );
    };

    const Globe = ({ lastBirth }) => {
      const canvasRef = useRef(null);
      const [geoData, setGeoData] = useState(null);
      const rotationRef = useRef([0, -15]); 
      const flashesRef = useRef(new Map());
      const animationRef = useRef();

      useEffect(() => {
        fetch('https://raw.githubusercontent.com/holtzy/D3-graph-gallery/master/DATA/world.geojson')
          .then(res => res.json())
          .then(data => setGeoData(data));
      }, []);

      useEffect(() => {
        if (!geoData || !canvasRef.current) return;
        const canvas = canvasRef.current;
        const context = canvas.getContext('2d');
        const dpr = window.devicePixelRatio || 1;

        const resize = () => {
          const { clientWidth, clientHeight } = canvas.parentElement;
          canvas.width = clientWidth * dpr;
          canvas.height = clientHeight * dpr;
          canvas.style.width = `${clientWidth}px`;
          canvas.style.height = `${clientHeight}px`;
          context.scale(dpr, dpr);
        };
        resize();
        window.addEventListener('resize', resize);

        const render = () => {
          const w = canvas.width / dpr;
          const h = canvas.height / dpr;
          const radius = Math.min(w, h) * 0.45;
          const cx = w * 0.75;
          const cy = h * 0.5;

          const projection = d3.geoOrthographic().scale(radius).translate([cx, cy]).clipAngle(90);
          const path = d3.geoPath(projection, context);

          context.clearRect(0, 0, w, h);
          rotationRef.current[0] += ROTATION_SPEED;
          projection.rotate(rotationRef.current);

          // Atmosphere Glow
          const grad = context.createRadialGradient(cx, cy, radius, cx, cy, radius + 100);
          grad.addColorStop(0, 'rgba(59, 130, 246, 0.08)');
          grad.addColorStop(1, 'transparent');
          context.fillStyle = grad;
          context.beginPath(); context.arc(cx, cy, radius + 100, 0, Math.PI * 2); context.fill();

          context.beginPath(); context.arc(cx, cy, radius, 0, Math.PI * 2);
          context.fillStyle = '#020617'; context.fill();

          const now = Date.now();
          geoData.features.forEach(f => {
            const centroid = d3.geoCentroid(f);
            const isVisible = d3.geoDistance(centroid, [-rotationRef.current[0], -rotationRef.current[1]]) < Math.PI/2;
            if (isVisible) {
              context.beginPath(); path(f);
              const flash = flashesRef.current.get(f.id);
              if (flash) {
                const age = now - flash.start;
                if (age > 1000) { 
                  flashesRef.current.delete(f.id); 
                  context.fillStyle = LAND_COLOR; 
                } else {
                  const t = age / 1000;
                  context.fillStyle = age < 50 ? FLASH_BURST_COLOR : d3.interpolateRgb(FLASH_BLOOM_COLOR, LAND_COLOR)(t);
                  context.shadowBlur = 20 * (1 - t);
                  context.shadowColor = FLASH_BLOOM_COLOR;
                }
              } else {
                context.fillStyle = LAND_COLOR;
                context.shadowBlur = 0;
              }
              context.fill();
              context.strokeStyle = 'rgba(255,255,255,0.02)';
              context.stroke();
            }
          });

          animationRef.current = requestAnimationFrame(render);
        };
        render();
        return () => {
          window.removeEventListener('resize', resize);
          cancelAnimationFrame(animationRef.current);
        };
      }, [geoData]);

      useEffect(() => {
        if (!lastBirth || !geoData) return;
        flashesRef.current.set(lastBirth.countryId, { start: Date.now() });
      }, [lastBirth]);

      return <div className="w-full h-full"><canvas ref={canvasRef} /></div>;
    };

    const App = () => {
      const [totalToday, setTotalToday] = useState(0);
      const [lastBirth, setLastBirth] = useState(null);
      const [time, setTime] = useState({ label: "00:00", pct: 0 });
      const count = useRef(0);

      useEffect(() => {
        const updateTime = () => {
          const d = new Date();
          const midnight = new Date(d.getFullYear(), d.getMonth(), d.getDate()).getTime();
          const elapsed = (d.getTime() - midnight) / 1000;
          const pct = (elapsed / 86400) * 100;
          setTime({ 
            label: d.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit', hour12: false }), 
            pct 
          });
          if (count.current === 0) {
            count.current = Math.floor(elapsed * BIRTHS_PER_SECOND);
            setTotalToday(count.current);
          }
        };
        updateTime();
        const t = setInterval(updateTime, 1000);

        const spawn = () => {
          const delay = -Math.log(Math.random()) * (1000 / BIRTHS_PER_SECOND);
          setTimeout(() => {
            count.current++;
            setTotalToday(count.current);
            const countries = ['IND', 'CHN', 'NGA', 'PAK', 'IDN', 'USA', 'ETH', 'BRA', 'BGD', 'COD', 'MEX', 'EGY', 'PHL', 'VNM', 'TUR'];
            setLastBirth({ countryId: countries[Math.floor(Math.random() * countries.length)], ts: Date.now() });
            spawn();
          }, delay);
        };
        spawn();
        return () => clearInterval(t);
      }, []);

      return (
        <div className="h-screen w-screen relative overflow-hidden bg-black">
          <StarField />
          <div className="absolute inset-0 z-10"><Globe lastBirth={lastBirth} /></div>
          
          <div className="absolute top-0 left-0 bottom-0 w-1/2 flex flex-col justify-center pl-24 z-20 glass-sidebar pointer-events-none">
            <div className="pointer-events-auto flex flex-col max-w-fit">
              
              <div className="mb-6 flex items-center">
                <span className="pulse-dot"></span>
                <span className="text-xs font-black tracking-[0.4em] uppercase text-red-500 opacity-90">Live Population Pulse</span>
              </div>

              <div className="mb-4">
                <div className="text-[0.75rem] uppercase tracking-[0.5em] text-blue-400 font-bold opacity-80">
                  Births Since Midnight
                </div>
              </div>

              <div className="mb-14">
                <div className="text-[12vw] counter-glow mono tabular-nums leading-none">
                  {new Intl.NumberFormat('en-US').format(totalToday)}
                </div>
              </div>

              <div className="w-full">
                <div className="progress-track relative">
                  <div className="progress-fill" style={{ width: `${time.pct}%` }}></div>
                  <div className="time-pin" style={{ left: `${time.pct}%` }}>
                    <span className="time-label mono">{time.label} UTC</span>
                  </div>
                </div>
              </div>

            </div>
          </div>
        </div>
      );
    };

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<App />);
  </script>
</body>
</html>