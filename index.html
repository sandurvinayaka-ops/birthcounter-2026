<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Live Global Birth Tracker</title>
  <!-- Stable CDNs for Production -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://d3js.org/d3.v7.min.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;900&family=JetBrains+Mono:wght@500&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Inter', sans-serif;
      background-color: #020617; /* Deepest Navy */
      color: #f1f5f9;
      margin: 0;
      padding: 0;
      overflow: hidden;
    }
    .mono { font-family: 'JetBrains+Mono', monospace; }
    
    /* Map Styles for Extreme Clarity */
    .land {
      fill: #1e293b; /* Slate 800 - Subtle land */
      stroke: #020617; /* Slate 950 - Sharp borders */
      stroke-width: 0.5;
    }
    
    .gold-glow {
      filter: drop-shadow(0 0 15px rgba(251, 191, 36, 0.4));
    }

    /* Animation for the live dot */
    @keyframes pulse-green {
      0% { transform: scale(0.95); box-shadow: 0 0 0 0 rgba(34, 197, 94, 0.7); }
      70% { transform: scale(1); box-shadow: 0 0 0 6px rgba(34, 197, 94, 0); }
      100% { transform: scale(0.95); box-shadow: 0 0 0 0 rgba(34, 197, 94, 0); }
    }
    .status-dot {
      animation: pulse-green 2s infinite;
    }
  </style>
<script type="importmap">
{
  "imports": {
    "react": "https://esm.sh/react@^19.2.3",
    "react/": "https://esm.sh/react@^19.2.3/",
    "d3": "https://esm.sh/d3@^7.9.0",
    "lucide-react": "https://esm.sh/lucide-react@^0.562.0"
  }
}
</script>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect, useCallback, useRef } = React;

    // --- Population Data (UN Estimates) ---
    const BIRTHS_PER_SECOND = 4.35;
    const COUNTRIES = [
      { id: 'IND', weight: 24.2 }, { id: 'CHN', weight: 9.4 },
      { id: 'NGA', weight: 8.0 }, { id: 'PAK', weight: 6.4 },
      { id: 'IDN', weight: 4.5 }, { id: 'USA', weight: 3.6 },
      { id: 'ETH', weight: 3.9 }, { id: 'BRA', weight: 2.7 },
      { id: 'BGD', weight: 3.0 }, { id: 'COD', weight: 4.1 },
      { id: 'RUS', weight: 1.4 }, { id: 'MEX', weight: 2.0 },
      { id: 'PHL', weight: 2.0 }, { id: 'EGY', weight: 2.6 },
      { id: 'VNM', weight: 1.5 }, { id: 'TUR', weight: 1.2 },
      { id: 'DEU', weight: 0.8 }, { id: 'GBR', weight: 0.7 },
      { id: 'FRA', weight: 0.7 }, { id: 'ZAF', weight: 1.2 },
      { id: 'OTHER', weight: 12.0 }
    ];

    const WorldMap = ({ activeCountryId }) => {
      const svgRef = useRef(null);
      const [geoData, setGeoData] = useState(null);

      useEffect(() => {
        // Fetch geojson from a stable source
        fetch('https://raw.githubusercontent.com/holtzy/D3-graph-gallery/master/DATA/world.geojson')
          .then(res => res.json())
          .then(data => setGeoData(data));
      }, []);

      useEffect(() => {
        if (!geoData || !svgRef.current) return;

        const svg = d3.select(svgRef.current);
        const width = svgRef.current.clientWidth;
        const height = svgRef.current.clientHeight;

        svg.selectAll("*").remove();

        // Optimized projection for visibility
        const projection = d3.geoMercator()
          .scale(width / 6.5)
          .translate([width / 2, height / 1.6]);

        const path = d3.geoPath().projection(projection);
        const mapGroup = svg.append("g");

        mapGroup.selectAll("path")
          .data(geoData.features)
          .enter()
          .append("path")
          .attr("d", path)
          .attr("class", d => `land country-${d.id}`)
          .style("transition", "fill 0.4s ease");

        const handleResize = () => {
          if (!svgRef.current) return;
          const w = svgRef.current.clientWidth;
          const h = svgRef.current.clientHeight;
          projection.scale(w / 6.5).translate([w / 2, h / 1.6]);
          mapGroup.selectAll("path").attr("d", path);
        };

        window.addEventListener('resize', handleResize);
        return () => window.removeEventListener('resize', handleResize);
      }, [geoData]);

      // Handle the flash effect
      useEffect(() => {
        if (!activeCountryId || !svgRef.current || !geoData) return;
        
        let targetId = activeCountryId;
        
        // Handle 'OTHER' by picking a random country that isn't in our major list
        if (targetId === "OTHER") {
          const majorIds = COUNTRIES.map(c => c.id);
          const others = geoData.features.filter(f => !majorIds.includes(f.id));
          if (others.length > 0) {
            targetId = others[Math.floor(Math.random() * others.length)].id;
          }
        }

        const gold = "#fbbf24"; // Amber 400
        const normal = "#1e293b"; // Slate 800
        
        const country = d3.select(svgRef.current).select(`.country-${targetId}`);
        if (!country.empty()) {
          country
            .interrupt()
            .transition()
            .duration(0)
            .style("fill", gold)
            .style("filter", `drop-shadow(0 0 15px ${gold})`)
            .transition()
            .duration(1500)
            .style("fill", normal)
            .style("filter", "none");
        }
      }, [activeCountryId, geoData]);

      return <svg ref={svgRef} className="w-full h-full" />;
    };

    const App = () => {
      const [totalToday, setTotalToday] = useState(0);
      const [activeCountryId, setActiveCountryId] = useState(null);
      const totalTodayRef = useRef(0);

      useEffect(() => {
        // Calculate births since midnight local time
        const now = new Date();
        const startOfDay = new Date(now.getFullYear(), now.getMonth(), now.getDate());
        const secondsSinceMidnight = (now.getTime() - startOfDay.getTime()) / 1000;
        const initialCount = Math.floor(secondsSinceMidnight * BIRTHS_PER_SECOND);
        
        setTotalToday(initialCount);
        totalTodayRef.current = initialCount;

        // Realistic timing simulation
        let timer;
        const scheduleBirth = () => {
          const delay = -Math.log(Math.random()) * (1000 / BIRTHS_PER_SECOND);
          timer = setTimeout(() => {
            const totalWeight = COUNTRIES.reduce((acc, c) => acc + c.weight, 0);
            let r = Math.random() * totalWeight;
            let selectedId = "OTHER";
            for (const c of COUNTRIES) {
              if (r < c.weight) { selectedId = c.id; break; }
              r -= c.weight;
            }
            
            totalTodayRef.current += 1;
            setTotalToday(totalTodayRef.current);
            // Clear then set to trigger effect even if it's the same country
            setActiveCountryId(null);
            setTimeout(() => setActiveCountryId(selectedId), 10);
            
            scheduleBirth();
          }, delay);
        };

        scheduleBirth();
        return () => clearTimeout(timer);
      }, []);

      return (
        <div className="h-screen w-screen flex flex-col bg-[#020617] overflow-hidden">
          <main className="flex-1 flex overflow-hidden">
            
            {/* Sidebar: Counter (35% Width) */}
            <div className="w-[35%] border-r border-slate-800 bg-slate-900/40 p-6 md:p-10 flex flex-col justify-center relative">
              <div className="absolute top-8 left-6 md:left-10 flex items-center gap-2 opacity-60">
                <svg className="w-4 h-4 text-amber-500" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="3">
                  <circle cx="12" cy="12" r="10"/><path d="M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20"/>
                  <path d="M2 12h20"/>
                </svg>
                <span className="text-[10px] font-black tracking-[0.4em] text-amber-500 uppercase">Live Pulse</span>
              </div>

              <div className="space-y-4">
                <h1 className="text-[10px] md:text-[12px] font-black tracking-[0.6em] text-slate-500 uppercase">Worldwide Births Today</h1>
                <div className="text-[7vw] md:text-[6.5vw] font-black text-amber-400 tabular-nums mono tracking-tighter gold-glow leading-none break-all">
                  {totalToday.toLocaleString()}
                </div>
              </div>

              <div className="absolute bottom-8 left-6 md:left-10 flex items-center gap-3">
                <div className="w-2 h-2 rounded-full bg-green-500 status-dot"></div>
                <span className="text-[10px] font-bold text-slate-600 tracking-widest uppercase">Streaming Global Data</span>
              </div>
            </div>

            {/* Main Area: Map (65% Width) */}
            <div className="flex-1 bg-[#020617] relative">
              <WorldMap activeCountryId={activeCountryId} />
              
              {/* Subtle Tech Overlay */}
              <div className="absolute inset-0 pointer-events-none opacity-[0.03] bg-[url('https://www.transparenttextures.com/patterns/carbon-fibre.png')]"></div>
            </div>
          </main>

          {/* Minimalist Tech Footer */}
          <footer className="h-10 px-6 md:px-10 bg-black/60 border-t border-slate-900 flex items-center justify-between">
            <div className="text-[9px] text-slate-700 font-mono tracking-[0.2em] uppercase hidden sm:block">Log:// births_detected_live.sh</div>
            <div className="text-[9px] text-slate-700 font-mono tracking-widest uppercase">Scale: 1:110,000,000 // Protocol: Mercator</div>
          </footer>
        </div>
      );
    };

    // Initialize React 18
    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<App />);
  </script>
</body>
</html>