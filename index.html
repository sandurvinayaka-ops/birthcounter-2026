<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Live Global Birth Tracker | Pulse</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://d3js.org/d3.v7.min.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&family=JetBrains+Mono:wght@500&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Inter', sans-serif;
      background-color: #020205; 
      color: #f1f5f9;
      margin: 0;
      padding: 0;
      overflow: hidden;
    }
    .mono { font-family: 'JetBrains+Mono', monospace; }
    
    /* Natural Space Background */
    .space-background {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: -1;
      overflow: hidden;
      background: #010103;
    }

    .nebula-layer {
      position: absolute;
      top: -50%;
      left: -50%;
      width: 200%;
      height: 200%;
      background-image: url('https://images.unsplash.com/photo-1464802686167-b939a6910659?q=80&w=2070&auto=format&fit=crop');
      background-size: cover;
      background-position: center;
      opacity: 0.5;
      filter: blur(1px) saturate(0.6) brightness(0.7); 
      animation: drift 180s linear infinite;
    }

    .cloud-overlay {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: url('https://www.transparenttextures.com/patterns/stardust.png');
      opacity: 0.4;
      animation: stars-twinkle 4s ease-in-out infinite alternate;
    }

    @keyframes drift {
      from { transform: rotate(0deg) scale(1); }
      to { transform: rotate(360deg) scale(1.1); }
    }

    @keyframes stars-twinkle {
      from { opacity: 0.2; }
      to { opacity: 0.5; }
    }

    /* Map Styles */
    .land {
      stroke: #020205;
      stroke-width: 0.4;
      transition: none; 
    }

    .graticule {
      fill: none;
      stroke: #a78bfa;
      stroke-width: 0.15;
      opacity: 0.15;
    }

    .globe-outline {
      fill: #12071f; /* Opaque solid deep midnight purple for water */
      stroke: rgba(167, 139, 250, 0.3);
      stroke-width: 1.5;
    }

    /* Sidebar Glassmorphism */
    .glass-sidebar {
      background: rgba(10, 11, 30, 0.85);
      backdrop-filter: blur(25px);
      border-right: 1px solid rgba(255, 255, 255, 0.05);
    }

    /* Spaced header text */
    .header-spaced {
      letter-spacing: 0.25em;
      font-weight: 800;
      color: #818cf8; 
    }

    /* Intense Glow for the Number */
    .amber-bloom {
      color: #fbbf24;
      filter: drop-shadow(0 0 45px rgba(251, 191, 36, 0.6));
    }

    /* Footer styling */
    .app-footer {
      height: 32px;
      background: rgba(1, 1, 3, 0.9);
      backdrop-filter: blur(8px);
      border-top: 1px solid rgba(255, 255, 255, 0.03);
    }
  </style>
<script type="importmap">
{
  "imports": {
    "react": "https://esm.sh/react@^19.2.3",
    "react/": "https://esm.sh/react@^19.2.3/",
    "d3": "https://esm.sh/d3@^7.9.0",
    "lucide-react": "https://esm.sh/lucide-react@^0.562.0"
  }
}
</script>
</head>
<body>
  <div class="space-background">
    <div class="nebula-layer"></div>
    <div class="cloud-overlay"></div>
  </div>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect, useRef } = React;

    const BIRTHS_PER_SECOND = 4.35;
    const GOLD_COLOR = "#FFD700"; 
    const IMPACT_COLOR = "#FFFFFF"; 
    const LAND_COLOR = "#4c1d95"; /* Deep purple for land masses */
    const STROKE_COLOR = "#020205";
    const ROTATION_SPEED = 0.45; 
    
    const COUNTRIES_WEIGHTS = [
      { id: 'IND', weight: 24.2 }, { id: 'CHN', weight: 9.4 },
      { id: 'NGA', weight: 8.0 }, { id: 'PAK', weight: 6.4 },
      { id: 'IDN', weight: 4.5 }, { id: 'USA', weight: 3.6 },
      { id: 'ETH', weight: 3.9 }, { id: 'BRA', weight: 2.7 },
      { id: 'BGD', weight: 3.0 }, { id: 'COD', weight: 4.1 },
      { id: 'RUS', weight: 1.4 }, { id: 'MEX', weight: 2.0 },
      { id: 'PHL', weight: 2.0 }, { id: 'EGY', weight: 2.6 },
      { id: 'VNM', weight: 1.5 }, { id: 'TUR', weight: 1.2 },
      { id: 'DEU', weight: 0.8 }, { id: 'GBR', weight: 0.7 },
      { id: 'FRA', weight: 0.7 }, { id: 'ZAF', weight: 1.2 },
      { id: 'OTHER', weight: 12.0 }
    ];

    const WorldMap = ({ lastBirth }) => {
      const svgRef = useRef(null);
      const [geoData, setGeoData] = useState(null);
      const rotationRef = useRef([0, -15]); 
      const activeFlashesRef = useRef(new Map()); 

      useEffect(() => {
        fetch('https://raw.githubusercontent.com/holtzy/D3-graph-gallery/master/DATA/world.geojson')
          .then(res => res.json())
          .then(data => {
            const filteredFeatures = data.features.filter(feature => feature.id !== 'ATA');
            setGeoData({ ...data, features: filteredFeatures });
          });
      }, []);

      useEffect(() => {
        if (!geoData || !svgRef.current) return;

        const svg = d3.select(svgRef.current);
        const width = svgRef.current.clientWidth;
        const height = svgRef.current.clientHeight;

        svg.selectAll("*").remove();

        const projection = d3.geoOrthographic()
          .scale(Math.min(width, height) / 2.1)
          .translate([width / 2, height / 2])
          .clipAngle(90);

        const path = d3.geoPath().projection(projection);
        
        svg.append("path")
          .datum({type: "Sphere"})
          .attr("class", "globe-outline")
          .attr("d", path);

        const graticule = d3.geoGraticule();
        const graticulePath = svg.append("path")
          .datum(graticule)
          .attr("class", "graticule")
          .attr("d", path);

        const mapGroup = svg.append("g");
        const countries = mapGroup.selectAll("path")
          .data(geoData.features)
          .enter()
          .append("path")
          .attr("d", path)
          .attr("class", d => `land country-${d.id}`)
          .attr("fill", LAND_COLOR)
          .attr("stroke", STROKE_COLOR);

        const timer = d3.timer((elapsed) => {
          rotationRef.current[0] += ROTATION_SPEED;
          projection.rotate(rotationRef.current);

          graticulePath.attr("d", path);
          svg.select(".globe-outline").attr("d", path);

          const now = Date.now();
          
          countries.each(function(d) {
            const countryPath = d3.select(this);
            countryPath.attr("d", path);

            const centroid = d3.geoCentroid(d);
            const visible = projection.clipAngle() === null || d3.geoDistance(centroid, [-rotationRef.current[0], -rotationRef.current[1]]) < Math.PI / 2;
            
            if (!visible) {
              countryPath.attr("opacity", 0);
              return;
            }
            countryPath.attr("opacity", 1);

            const flash = activeFlashesRef.current.get(d.id);
            if (flash) {
              const age = now - flash.startTime;
              if (age > 2000) {
                activeFlashesRef.current.delete(d.id);
                countryPath.attr("fill", LAND_COLOR).attr("stroke", STROKE_COLOR).style("filter", "none");
              } else {
                let color;
                if (age < 50) {
                  color = IMPACT_COLOR;
                  countryPath.style("filter", `drop-shadow(0 0 40px ${GOLD_COLOR}) brightness(1.8)`);
                } else {
                  const t = (age - 50) / 1950;
                  color = d3.interpolateRgb(GOLD_COLOR, LAND_COLOR)(t);
                  countryPath.style("filter", t < 0.5 ? `drop-shadow(0 0 ${40 * (1-t)}px ${GOLD_COLOR})` : "none");
                }
                countryPath.attr("fill", color).attr("stroke", color);
              }
            }
          });
        });

        const handleResize = () => {
          if (!svgRef.current) return;
          const w = svgRef.current.clientWidth;
          const h = svgRef.current.clientHeight;
          projection.scale(Math.min(w, h) / 2.1).translate([w / 2, h / 2]);
        };

        window.addEventListener('resize', handleResize);
        return () => {
          timer.stop();
          window.removeEventListener('resize', handleResize);
        };
      }, [geoData]);

      useEffect(() => {
        if (!lastBirth || !geoData) return;
        
        let targetId = lastBirth.countryId;
        if (targetId === "OTHER") {
          const others = geoData.features.filter(f => !COUNTRIES_WEIGHTS.some(c => c.id === f.id));
          if (others.length > 0) {
            targetId = others[Math.floor(Math.random() * others.length)].id;
          }
        }
        
        activeFlashesRef.current.set(targetId, { startTime: Date.now() });
      }, [lastBirth]);

      return <svg ref={svgRef} className="w-full h-full" />;
    };

    const App = () => {
      const [totalToday, setTotalToday] = useState(0);
      const [lastBirth, setLastBirth] = useState(null);
      const totalTodayRef = useRef(0);

      useEffect(() => {
        const now = new Date();
        const startOfDay = new Date(now.getFullYear(), now.getMonth(), now.getDate());
        const initialCount = Math.floor(((now.getTime() - startOfDay.getTime()) / 1000) * BIRTHS_PER_SECOND);
        
        setTotalToday(initialCount);
        totalTodayRef.current = initialCount;

        const schedule = () => {
          const delay = -Math.log(Math.random()) * (1000 / BIRTHS_PER_SECOND);
          setTimeout(() => {
            const totalWeight = COUNTRIES_WEIGHTS.reduce((acc, c) => acc + c.weight, 0);
            let r = Math.random() * totalWeight;
            let selectedId = "OTHER";
            for (const c of COUNTRIES_WEIGHTS) {
              if (r < c.weight) { selectedId = c.id; break; }
              r -= c.weight;
            }
            totalTodayRef.current += 1;
            setTotalToday(totalTodayRef.current);
            setLastBirth({ countryId: selectedId, timestamp: Date.now() });
            schedule();
          }, delay);
        };
        schedule();
      }, []);

      return (
        <div className="h-screen w-screen flex flex-col bg-transparent overflow-hidden">
          
          <div className="flex-1 flex overflow-hidden">
            {/* Wider Sidebar (35%) with Centered Content */}
            <div className="w-[40%] flex flex-col justify-center items-center p-12 relative glass-sidebar z-10 shadow-2xl">
              
              <div className="absolute top-12 left-12 flex items-center gap-3 opacity-80">
                <svg className="w-5 h-5 text-amber-500" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5">
                  <circle cx="12" cy="12" r="10"/><path d="M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20"/><path d="M2 12h20"/>
                </svg>
                <span className="text-[12px] font-black tracking-[0.4em] text-amber-500 uppercase">Live Pulse</span>
              </div>

              <div className="w-full max-w-xl text-center">
                <div className="header-spaced text-4xl uppercase mb-8 leading-tight font-black">
                  Worldwide<br/>Births Today
                </div>
                <div className="text-[7.5vw] font-black amber-bloom mono leading-none tracking-tighter whitespace-nowrap">
                  {totalToday.toLocaleString()}
                </div>
              </div>
            </div>

            {/* Rotating 3D Globe Area */}
            <div className="flex-1 relative flex items-center justify-center">
               <WorldMap lastBirth={lastBirth} />
            </div>
          </div>

          <footer className="app-footer flex items-center justify-between px-6 shrink-0 z-20">
          </footer>
        </div>
      );
    };

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<App />);
  </script>
</body>
</html>